<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Single Factor Residuals Genome Wide Association Study</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link rel="stylesheet" href="/opt/R/x86_64-pc-linux-gnu-library/4.0/rmarkdown/rmarkdown/templates/html_vignette/resources/vignette.css" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Single Factor Residuals Genome Wide Association Study</h1>



<p>The Residuals GWAS Model is a variant of the One Factor GWAS Model where the SNP directly predicts one or more of the item-specific residuals, after accounting for the latent variable. The Figure below presents a schematic representation of the Residuals Model. The identification requirements are the same as for the one factor GW-SEM model. The notable difference is that the individual items are regressed on each SNP (γ<sub>k</sub>). The residuals model allows researchers to regress a SNP on the residuals of the items that contribute to a latent factor. It is also possible to fit the residuals model so that the latent factor and a subset of the items are regressed on the SNPs. If you do this, in order to identify the SEM it is only possible to regress a subset of the items and the latent factor on the SNP or the model will not be identified.</p>
<p>In the Figure below, the circle (F<sub>1</sub>) is the latent factor, and the squares (x<sub>k</sub>) are observed indicators of the latent factor. The latent factor and observed indicators are connected by the factor loadings (λ<sub>k</sub>). The residual variances (δ<sub>k</sub>) represent the remaining variance in (x<sub>k</sub>) that is not shared with the latent factor. The regression of the observed items on the SNP (for all SNPs in the analysis) is depicted by (γ<sub>k</sub>).</p>
<div class="figure">
<img src="https://jpritikin.github.io/gwsem/exampleFigs/resid.jpg" alt="A schematic depiction of the Residuals Model" />
<p class="caption">A schematic depiction of the Residuals Model</p>
</div>
<div id="example" class="section level2">
<h2>Example</h2>
<p>To demonstrate how to use the Residuals model function, we use the same simulated data that we used for the one factor GWAS model example. Specifically, we simulated data for 6,000 individuals consisting of 2,000 SNPs, three correlated items and 6 covariates (that are a proxy for age, sex, ancestry principle components or other confounds). The simulated data are loosely based upon the data used in the demonstration of Pritikin et al (under review). In the paper, we examined the association a latent substance use frequency variable that used tobacco, cannabis, and alcohol as indicators. The latent variable was regressed on each SNP with a minor allele frequency larger than 1%.</p>
</div>
<div id="running-the-one-factor-residuals-gwas" class="section level2">
<h2>Running the One-Factor Residuals GWAS</h2>
<p><strong>Note: Many of these steps are similar to those that you would take to run the One Factor GWAS.</strong></p>
<p>The first step is opening R and loading the GW-SEM package into the R computing environment (which will also load all of the dependencies, such as OpenMx), which can be achieved by using the command below:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(gwsem)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">#&gt; Loading required package: OpenMx</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt; To take full advantage of multiple cores, use:</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt;   mxOption(key=&#39;Number of Threads&#39;, value=parallel::detectCores()) #now</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt;   Sys.setenv(OMP_NUM_THREADS=parallel::detectCores()) #before library(OpenMx)</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; Attaching package: &#39;gwsem&#39;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; The following object is masked from &#39;package:base&#39;:</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt;     signif</span></a></code></pre></div>
<p>The next step is to load the phenotypic data. This will include any items that define the latent variable or necessary covariates that you will include in the analysis, such as age, sex, or ancestry principle components. Once the phenotypic data has been loaded, it is advisable to make sure the data has been loaded properly. This can be done in a number of ways. For example, you can use the <code>head</code> command to inspect the first few lines of data, look at the means and variances, construct tables of ordinal variables, etc. If your data didn’t load properly, it will likely cause problems for the analysis and for the interpretation of the results.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">location &lt;-<span class="st"> &#39;https://jpritikin.github.io/gwsem/gwsemOneFacExample&#39;</span></a>
<a class="sourceLine" id="cb2-2" title="2">phenoData &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">file.path</span>(location, <span class="st">&quot;oneFacphenoData.txt&quot;</span>), <span class="dt">header=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">head</span>(phenoData)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&gt;       tobacco  cannabis    alcohol        pc1        pc2        pc3         pc4</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&gt; 1  3.36379197 1.9456836  2.8611092  0.6581600 -0.1200383 -0.5039244  0.81789068</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&gt; 2 -0.04339055 0.8374107  1.1329506 -0.4456708  1.6999452  0.2989812 -0.01336187</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt; 3  2.34493591 1.7822021  1.2619447 -0.5075578  0.5317262  0.8304545 -1.08527994</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&gt; 4  1.94136139 1.4179373  1.0871179 -0.2108447  0.9508879  0.1536526 -1.43699546</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&gt; 5  1.07733966 0.9755835 -1.3167313  0.2835382 -1.6955112 -2.2021556  0.44969009</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">#&gt; 6  1.63174525 1.0087218  0.7508155  0.4177546  0.3278404  0.2418577 -2.67388373</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">#&gt;           pc5</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">#&gt; 1  2.34856223</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">#&gt; 2 -0.67114825</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">#&gt; 3  0.02086144</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="co">#&gt; 4  0.58885216</span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="co">#&gt; 5 -0.67308854</span></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co">#&gt; 6 -0.58135826</span></a></code></pre></div>
<p>Once the data are loaded into R, you can recode the data, transform it, and tell R if we have ordinal or binary indicators using <code>mxFactor()</code>. The data for this example are simulated and continuous, and therefore, we will not be doing anything now, but if you would like to chop the indicators up into binary or ordinal variables, this would be when you would do it.</p>
<p>After you are satisfied that the data are in the appropriate shape we can build a one factor GWAS model with the following command:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">                                                                                       <span class="co"># You must tell GW-SEM:</span></a>
<a class="sourceLine" id="cb3-2" title="2">addFacRes &lt;-<span class="st"> </span><span class="kw">buildOneFacRes</span>(phenoData,                                                 <span class="co"># what the data object is (which you read in above)</span></a>
<a class="sourceLine" id="cb3-3" title="3">                     <span class="dt">itemNames =</span> <span class="kw">c</span>(<span class="st">&quot;tobacco&quot;</span>, <span class="st">&quot;cannabis&quot;</span>, <span class="st">&quot;alcohol&quot;</span>),                  <span class="co"># what the items of the latent factor are</span></a>
<a class="sourceLine" id="cb3-4" title="4">                     <span class="dt">res =</span> <span class="kw">c</span>(<span class="st">&quot;tobacco&quot;</span>, <span class="st">&quot;cannabis&quot;</span>, <span class="st">&quot;alcohol&quot;</span>),                        <span class="co"># the items you want to regress onto the SNP (the default is all of the items)</span></a>
<a class="sourceLine" id="cb3-5" title="5">                     <span class="dt">factor =</span> F,                                                       <span class="co"># factor is set to F by default</span></a>
<a class="sourceLine" id="cb3-6" title="6">                     <span class="dt">covariates=</span><span class="kw">c</span>(<span class="st">&#39;pc1&#39;</span>,<span class="st">&#39;pc2&#39;</span>,<span class="st">&#39;pc3&#39;</span>,<span class="st">&#39;pc4&#39;</span>,<span class="st">&#39;pc5&#39;</span>),                      <span class="co"># what covariates that you want to include in the analysis</span></a>
<a class="sourceLine" id="cb3-7" title="7">                     <span class="dt">fitfun =</span> <span class="st">&quot;WLS&quot;</span>)                                                   <span class="co"># and the fit function that you would like to use (WLS is much faster than ML)</span></a></code></pre></div>
<p><strong>Note about regressing the latent factor and SOME of the items on the SNPs:</strong> The model is not identified if both the latent variable and all of the items are simultaneously regressed on the SNP. In some cases, however, it may be important to understand the effect of the SNP on both the latent factor and the items. In such cases, you must remove at least path from the SNP to the item residuals, and then it is possible to toggle the <em>factor</em> argument from FALSE to TRUE.</p>
<p>You can take this object (<code>addFacRes</code>) which is technically an OpenMx model, and simply fit it using <code>mxRun()</code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">addFacResFit &lt;-<span class="st"> </span><span class="kw">mxRun</span>(addFacRes)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">#&gt; Running OneFacRes with 29 parameters</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">summary</span>(addFacResFit)</a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt; Summary of OneFacRes </span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt;  </span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt; free parameters:</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt;               name matrix      row      col     Estimate  Std.Error lbound</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt; 1   snp_to_tobacco      A  tobacco      snp  0.007166774 0.01831431       </span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt; 2  snp_to_cannabis      A cannabis      snp  0.018824131 0.01849666       </span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt; 3   snp_to_alcohol      A  alcohol      snp  0.035270907 0.01856413       </span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt; 4   lambda_tobacco      A  tobacco        F  0.714703635 0.01407260       </span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; 5  lambda_cannabis      A cannabis        F  0.716511862 0.01378356       </span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt; 6   lambda_alcohol      A  alcohol        F  0.712271688 0.01376622       </span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt; 7   pc1_to_tobacco      A  tobacco      pc1  0.013600354 0.01324234       </span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt; 8  pc1_to_cannabis      A cannabis      pc1  0.034214118 0.01342516       </span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt; 9   pc1_to_alcohol      A  alcohol      pc1  0.006605336 0.01321714       </span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">#&gt; 10  pc2_to_tobacco      A  tobacco      pc2  0.016604856 0.01294531       </span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co">#&gt; 11 pc2_to_cannabis      A cannabis      pc2 -0.012060134 0.01292010       </span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="co">#&gt; 12  pc2_to_alcohol      A  alcohol      pc2 -0.014386349 0.01307769       </span></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="co">#&gt; 13  pc3_to_tobacco      A  tobacco      pc3  0.007312021 0.01300120       </span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">#&gt; 14 pc3_to_cannabis      A cannabis      pc3  0.019124630 0.01285771       </span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="co">#&gt; 15  pc3_to_alcohol      A  alcohol      pc3  0.019525141 0.01311066       </span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="co">#&gt; 16  pc4_to_tobacco      A  tobacco      pc4 -0.024739970 0.01334323       </span></a>
<a class="sourceLine" id="cb4-24" title="24"><span class="co">#&gt; 17 pc4_to_cannabis      A cannabis      pc4 -0.021984991 0.01300454       </span></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="co">#&gt; 18  pc4_to_alcohol      A  alcohol      pc4 -0.046430727 0.01291756       </span></a>
<a class="sourceLine" id="cb4-26" title="26"><span class="co">#&gt; 19  pc5_to_tobacco      A  tobacco      pc5 -0.027658975 0.01294690       </span></a>
<a class="sourceLine" id="cb4-27" title="27"><span class="co">#&gt; 20 pc5_to_cannabis      A cannabis      pc5  0.011439623 0.01315082       </span></a>
<a class="sourceLine" id="cb4-28" title="28"><span class="co">#&gt; 21  pc5_to_alcohol      A  alcohol      pc5 -0.017530559 0.01315651       </span></a>
<a class="sourceLine" id="cb4-29" title="29"><span class="co">#&gt; 22         snp_res      S      snp      snp  0.499413083 0.01288508  0.001</span></a>
<a class="sourceLine" id="cb4-30" title="30"><span class="co">#&gt; 23     tobacco_res      S  tobacco  tobacco  0.508562194 0.01505682  0.001</span></a>
<a class="sourceLine" id="cb4-31" title="31"><span class="co">#&gt; 24    cannabis_res      S cannabis cannabis  0.508357372 0.01474115  0.001</span></a>
<a class="sourceLine" id="cb4-32" title="32"><span class="co">#&gt; 25     alcohol_res      S  alcohol  alcohol  0.509128598 0.01438935  0.001</span></a>
<a class="sourceLine" id="cb4-33" title="33"><span class="co">#&gt; 26         snpMean      M        1      snp  1.020500000 0.00912717       </span></a>
<a class="sourceLine" id="cb4-34" title="34"><span class="co">#&gt; 27     tobaccoMean      M        1  tobacco  0.712531627 0.02280868       </span></a>
<a class="sourceLine" id="cb4-35" title="35"><span class="co">#&gt; 28    cannabisMean      M        1 cannabis  0.702877106 0.02296187       </span></a>
<a class="sourceLine" id="cb4-36" title="36"><span class="co">#&gt; 29     alcoholMean      M        1  alcohol  0.685352413 0.02301247       </span></a>
<a class="sourceLine" id="cb4-37" title="37"><span class="co">#&gt;    ubound</span></a>
<a class="sourceLine" id="cb4-38" title="38"><span class="co">#&gt; 1        </span></a>
<a class="sourceLine" id="cb4-39" title="39"><span class="co">#&gt; 2        </span></a>
<a class="sourceLine" id="cb4-40" title="40"><span class="co">#&gt; 3        </span></a>
<a class="sourceLine" id="cb4-41" title="41"><span class="co">#&gt; 4        </span></a>
<a class="sourceLine" id="cb4-42" title="42"><span class="co">#&gt; 5        </span></a>
<a class="sourceLine" id="cb4-43" title="43"><span class="co">#&gt; 6        </span></a>
<a class="sourceLine" id="cb4-44" title="44"><span class="co">#&gt; 7        </span></a>
<a class="sourceLine" id="cb4-45" title="45"><span class="co">#&gt; 8        </span></a>
<a class="sourceLine" id="cb4-46" title="46"><span class="co">#&gt; 9        </span></a>
<a class="sourceLine" id="cb4-47" title="47"><span class="co">#&gt; 10       </span></a>
<a class="sourceLine" id="cb4-48" title="48"><span class="co">#&gt; 11       </span></a>
<a class="sourceLine" id="cb4-49" title="49"><span class="co">#&gt; 12       </span></a>
<a class="sourceLine" id="cb4-50" title="50"><span class="co">#&gt; 13       </span></a>
<a class="sourceLine" id="cb4-51" title="51"><span class="co">#&gt; 14       </span></a>
<a class="sourceLine" id="cb4-52" title="52"><span class="co">#&gt; 15       </span></a>
<a class="sourceLine" id="cb4-53" title="53"><span class="co">#&gt; 16       </span></a>
<a class="sourceLine" id="cb4-54" title="54"><span class="co">#&gt; 17       </span></a>
<a class="sourceLine" id="cb4-55" title="55"><span class="co">#&gt; 18       </span></a>
<a class="sourceLine" id="cb4-56" title="56"><span class="co">#&gt; 19       </span></a>
<a class="sourceLine" id="cb4-57" title="57"><span class="co">#&gt; 20       </span></a>
<a class="sourceLine" id="cb4-58" title="58"><span class="co">#&gt; 21       </span></a>
<a class="sourceLine" id="cb4-59" title="59"><span class="co">#&gt; 22       </span></a>
<a class="sourceLine" id="cb4-60" title="60"><span class="co">#&gt; 23       </span></a>
<a class="sourceLine" id="cb4-61" title="61"><span class="co">#&gt; 24       </span></a>
<a class="sourceLine" id="cb4-62" title="62"><span class="co">#&gt; 25       </span></a>
<a class="sourceLine" id="cb4-63" title="63"><span class="co">#&gt; 26       </span></a>
<a class="sourceLine" id="cb4-64" title="64"><span class="co">#&gt; 27       </span></a>
<a class="sourceLine" id="cb4-65" title="65"><span class="co">#&gt; 28       </span></a>
<a class="sourceLine" id="cb4-66" title="66"><span class="co">#&gt; 29       </span></a>
<a class="sourceLine" id="cb4-67" title="67"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-68" title="68"><span class="co">#&gt; Model Statistics: </span></a>
<a class="sourceLine" id="cb4-69" title="69"><span class="co">#&gt;                |  Parameters  |  Degrees of Freedom  |  Fit (r&#39;Wr units)</span></a>
<a class="sourceLine" id="cb4-70" title="70"><span class="co">#&gt;        Model:             29                  23971         7.011578e-17</span></a>
<a class="sourceLine" id="cb4-71" title="71"><span class="co">#&gt;    Saturated:             14                  23986         0.000000e+00</span></a>
<a class="sourceLine" id="cb4-72" title="72"><span class="co">#&gt; Independence:              8                  23992                   NA</span></a>
<a class="sourceLine" id="cb4-73" title="73"><span class="co">#&gt; Number of observations/statistics: 6000/24000</span></a>
<a class="sourceLine" id="cb4-74" title="74"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-75" title="75"><span class="co">#&gt; chi-square:  χ² ( df=5 ) = 1.575792e-53,  p = 1</span></a>
<a class="sourceLine" id="cb4-76" title="76"><span class="co">#&gt; CFI: NA </span></a>
<a class="sourceLine" id="cb4-77" title="77"><span class="co">#&gt; TLI: NA   (also known as NNFI) </span></a>
<a class="sourceLine" id="cb4-78" title="78"><span class="co">#&gt; RMSEA: 0 *(Non-centrality parameter is negative)  [95% CI (0, 0)]</span></a>
<a class="sourceLine" id="cb4-79" title="79"><span class="co">#&gt; Prob(RMSEA &lt;= 0.05): 1</span></a>
<a class="sourceLine" id="cb4-80" title="80"><span class="co">#&gt; To get additional fit indices, see help(mxRefModels)</span></a>
<a class="sourceLine" id="cb4-81" title="81"><span class="co">#&gt; timestamp: 2020-07-10 20:06:06 </span></a>
<a class="sourceLine" id="cb4-82" title="82"><span class="co">#&gt; Wall clock time: 0.491261 secs </span></a>
<a class="sourceLine" id="cb4-83" title="83"><span class="co">#&gt; optimizer:  SLSQP </span></a>
<a class="sourceLine" id="cb4-84" title="84"><span class="co">#&gt; OpenMx version number: 2.17.4 </span></a>
<a class="sourceLine" id="cb4-85" title="85"><span class="co">#&gt; Need help?  See help(mxSummary)</span></a></code></pre></div>
<p>This is strongly advised, as it is a great time to test whether the model is being specified the way you want it to be and that you are not getting unexpected estimates.</p>
<p>Provided that the model looks reasonable, you can plug the model that you have built into the <code>GWAS</code> function using the command below:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">library</span>(curl)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">curl_download</span>(<span class="kw">file.path</span>(location, <span class="st">&#39;example.pgen&#39;</span>),</a>
<a class="sourceLine" id="cb5-3" title="3">              <span class="kw">file.path</span>(<span class="kw">tempdir</span>(),<span class="st">&#39;example.pgen&#39;</span>))</a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">curl_download</span>(<span class="kw">file.path</span>(location, <span class="st">&#39;example.pvar&#39;</span>),</a>
<a class="sourceLine" id="cb5-5" title="5">              <span class="kw">file.path</span>(<span class="kw">tempdir</span>(),<span class="st">&#39;example.pvar&#39;</span>))</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="kw">GWAS</span>(<span class="dt">model =</span> addFacRes,                                                                 <span class="co"># what model object you would like to fit</span></a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="dt">snpData =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&#39;example.pgen&#39;</span>),                                                        <span class="co"># that path to the snpData file.</span></a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="dt">out=</span><span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&quot;FacRes.log&quot;</span>),                                                                <span class="co"># the file that you would like to save the full results into</span></a>
<a class="sourceLine" id="cb5-10" title="10">    <span class="dt">SNP=</span><span class="dv">1</span><span class="op">:</span><span class="dv">200</span>)                                                                       <span class="co"># the index of the snps (how many) you would like to fit</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt; Running OneFacRes with 29 parameters</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt; Done. See &#39;/tmp/Rtmp2Mjcyf/FacRes.log&#39; for results</span></a></code></pre></div>
<p>While the <code>GWAS</code> function will take a while and frequently be executed on a computing cluster, it is very useful to run a few SNPs (say 10 or 50) in an interactive session to ensure that: all of your relative file paths to the genotypes are correct, the model is taking a reasonable amount of time (i.e. 1-2 seconds/snp), the SNPs are giving sensible estimates, etc., as the results from a few SNPs can often tell you if there is a problem and that you are running a nonsensical model.</p>
<p>Refer to local documentation to learn how to submit jobs to your cluster queue submission systems. The R script that you provide will typically be similar to the one below:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">library</span>(gwsem)</a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3">phenoData &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">file.path</span>(location, <span class="st">&quot;oneFacphenoData.txt&quot;</span>), <span class="dt">header=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">head</span>(phenoData)</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt;       tobacco  cannabis    alcohol        pc1        pc2        pc3         pc4</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; 1  3.36379197 1.9456836  2.8611092  0.6581600 -0.1200383 -0.5039244  0.81789068</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt; 2 -0.04339055 0.8374107  1.1329506 -0.4456708  1.6999452  0.2989812 -0.01336187</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; 3  2.34493591 1.7822021  1.2619447 -0.5075578  0.5317262  0.8304545 -1.08527994</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; 4  1.94136139 1.4179373  1.0871179 -0.2108447  0.9508879  0.1536526 -1.43699546</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt; 5  1.07733966 0.9755835 -1.3167313  0.2835382 -1.6955112 -2.2021556  0.44969009</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">#&gt; 6  1.63174525 1.0087218  0.7508155  0.4177546  0.3278404  0.2418577 -2.67388373</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">#&gt;           pc5</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">#&gt; 1  2.34856223</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">#&gt; 2 -0.67114825</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">#&gt; 3  0.02086144</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">#&gt; 4  0.58885216</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co">#&gt; 5 -0.67308854</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">#&gt; 6 -0.58135826</span></a>
<a class="sourceLine" id="cb6-19" title="19"></a>
<a class="sourceLine" id="cb6-20" title="20">addFacRes &lt;-<span class="st"> </span><span class="kw">buildOneFacRes</span>(phenoData,                                                 <span class="co"># what the data object is (which you read in above)</span></a>
<a class="sourceLine" id="cb6-21" title="21">                     <span class="kw">c</span>(<span class="st">&quot;tobacco&quot;</span>, <span class="st">&quot;cannabis&quot;</span>, <span class="st">&quot;alcohol&quot;</span>),                              <span class="co"># what the items of the latent factor are</span></a>
<a class="sourceLine" id="cb6-22" title="22">                     <span class="dt">covariates=</span><span class="kw">c</span>(<span class="st">&#39;pc1&#39;</span>,<span class="st">&#39;pc2&#39;</span>,<span class="st">&#39;pc3&#39;</span>,<span class="st">&#39;pc4&#39;</span>,<span class="st">&#39;pc5&#39;</span>),                      <span class="co"># what covariates that you want to include in the analysis</span></a>
<a class="sourceLine" id="cb6-23" title="23">                     <span class="dt">fitfun =</span> <span class="st">&quot;WLS&quot;</span>)                                                   <span class="co"># and the fit function that you would like to use (WLS is much faster than ML)</span></a>
<a class="sourceLine" id="cb6-24" title="24"></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="kw">GWAS</span>(<span class="dt">model =</span> addFacRes,                                                                 <span class="co"># what model object you would like to fit</span></a>
<a class="sourceLine" id="cb6-26" title="26">    <span class="dt">snpData =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&#39;example.pgen&#39;</span>),                                                        <span class="co"># that path to the snpData file.</span></a>
<a class="sourceLine" id="cb6-27" title="27">    <span class="dt">out=</span><span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&quot;facRes.log&quot;</span>))                                                                <span class="co"># the file that you would like to save the full results into</span></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="co">#&gt; Running OneFacRes with 29 parameters</span></a>
<a class="sourceLine" id="cb6-29" title="29"><span class="co">#&gt; Done. See &#39;/tmp/Rtmp2Mjcyf/facRes.log&#39; for results</span></a></code></pre></div>
<p>The next step is to read the results into R. The output from the <code>GWAS</code> function contains all of the estimates and standard errors for all parameters in the model (for each SNP), as well as other general model fitting information. While you are unlikely to want to read all of this output into R, it is useful to do this with a small test GWAS analysis to ensure that you are getting reasonable results and to familiarize yourself with what information is available, in case you need to explore a specific parameter or model in more detail. This can be done with,</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">FullResult &lt;-<span class="st"> </span><span class="kw">read.delim</span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&quot;facRes.log&quot;</span>))</a></code></pre></div>
<p>More likely, you are going to want to focus on only the SNP regression coefficients. The <code>loadResults</code> function takes takes two arguments: the path to the data and the column name from the results file for the parameter that you want to examine.</p>
<p>Now that we have run the residual’s model, we have three parameters that we want to load into R. The function to do this is the same as for one parameter, but you need to do it three times. This obtains several R objects,</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">succinct &lt;-<span class="st"> </span><span class="kw">loadResults</span>(<span class="dt">path =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&quot;facRes.log&quot;</span>), <span class="dt">focus =</span>  <span class="kw">paste0</span>(<span class="st">&quot;snp_to_&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;tobacco&quot;</span>, <span class="st">&quot;cannabis&quot;</span>, <span class="st">&quot;alcohol&quot;</span>)))</a>
<a class="sourceLine" id="cb8-2" title="2">succinctTob &lt;-<span class="st"> </span><span class="kw">signif</span>(succinct, <span class="st">&quot;snp_to_tobacco&quot;</span>)</a>
<a class="sourceLine" id="cb8-3" title="3">succinctCan &lt;-<span class="st"> </span><span class="kw">signif</span>(succinct, <span class="st">&quot;snp_to_cannabis&quot;</span>)</a>
<a class="sourceLine" id="cb8-4" title="4">succinctAlc &lt;-<span class="st"> </span><span class="kw">signif</span>(succinct, <span class="st">&quot;snp_to_alcohol&quot;</span>)</a></code></pre></div>
</div>
<div id="now-we-can-plot-all-the-residual-manhattan-plots" class="section level1">
<h1>Now we can plot all the residual manhattan plots</h1>
<p>We can construct a Manhattan plot using the GW-SEM <code>plot()</code> function.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">plot</span>(succinctTob)</a></code></pre></div>
<p><img src="ResidualsModel_files/figure-html/unnamed-chunk-10-1.png" /><!-- --></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">plot</span>(succinctCan)</a></code></pre></div>
<p><img src="ResidualsModel_files/figure-html/unnamed-chunk-10-2.png" /><!-- --></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">plot</span>(succinctAlc)</a></code></pre></div>
<p><img src="ResidualsModel_files/figure-html/unnamed-chunk-10-3.png" /><!-- --></p>
<p>The <code>loadResults()</code> function formats the summary statistics from the analyses so that the data object can be seamlessly used by <code>qqman</code>, LDhub, and other post GWAS processing software.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
